
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cyber Security: A Worst-Case Scenario &#8212; The Buzz</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">The Buzz</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../index.html">
   Preface
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  The Buzz
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../onboarding/chapter.html">
   Onboarding
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../onboarding/software-need.html">
     Software Youâ€™ll Need
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../onboarding/creating-online-profile.html">
     Creating your Online Profile
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../onboarding/quick-tour-source-code.html">
     A Quick Tour of the Source Code
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../onboarding/deploying-project.html">
     Deploying the Project
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference external" href="https://the-buzz-demo.herokuapp.com">
     A Working Example of the Website
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../version-control/chapter.html">
   Version Control
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../version-control/what-is-git.html">
     What is Git?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../version-control/getting-started-with-git.html">
     Getting Started with Git
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../version-control/making-changes-to-code.html">
     Making Changes to our Code
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../version-control/git-for-code-review.html">
     Using Git for Code Review
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../version-control/pull-requests-merging-branches.html">
     Pull Requests &amp; Merging Branches
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../planning-a-project/chapter.html">
   Planning a Project
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../planning-a-project/what-is-agile.html">
     What is Agile?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../planning-a-project/trello-new-workboard.html">
     Trello: Your new Work Board
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../web/chapter.html">
   The Web UI
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../web/running-web-ui-locally.html">
     Running the Web UI Locally
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../web/writing-new-e2e-tests.html">
     Writing New End-to-End Tests
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../web/adding-message-list.html">
     Adding the Message List
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../web/adding-message-view.html">
     Adding the Message View
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../android/chapter.html">
   The Androdi App
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../backend/chapter.html">
   The Backend API
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../backend/running-backend-locally.html">
     Running the Backend Locally
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../backend/writing-new-unit-tests.html">
     Writing New Unit Tests
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../backend/writing-new-api-validators.html">
     Writing New API Validators
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../backend/adding-routes-handle-messages.html">
     Adding Routes to handle Messages
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../database/chapter.html">
   The Database Library
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../finishing-the-sprint/chapter.html">
   Finishing the Sprint
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Appendix
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../alternatives.html">
   Alternatives
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../glossary.html">
   Glossary
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../bibliography.html">
   Bibliography
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../fdl-1.3.html">
   GNU Free Documentation License
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/appendix/cyber-security/chapter.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/buck-ross/survival-guide"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/buck-ross/survival-guide/issues/new?title=Issue%20on%20page%20%2Fappendix/cyber-security/chapter.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/buck-ross/survival-guide/master?urlpath=tree/the_buzz/appendix/cyber-security/chapter.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-desceptively-terrifying-example">
   A Desceptively Terrifying Example
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#let-the-cyber-attacks-begin">
   Let the Cyber Attacks Begin!
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="cyber-security-a-worst-case-scenario">
<h1>Cyber Security: A Worst-Case Scenario<a class="headerlink" href="#cyber-security-a-worst-case-scenario" title="Permalink to this headline">Â¶</a></h1>
<div class="danger admonition">
<p class="admonition-title">Disclaimer</p>
<p>This chapter displays executable code (and the results of running said code) designed to perpetrate
serious cyber attacks against the provided example of a vulnerable application.
These code segments were strictly run against software running on servers owned and operated by the author of
this book.</p>
<p>Do <strong>NOT, UNDER ANY CIRCUMSTANCES</strong> attempt any of these attacks against a third-party service,
with the express consent of the owner of said service to test the attack.</p>
<p>By continuing to read this chapter, you acknowledge that we, the authors of this book, are in no way responsible
for the actions you choose to take with the knowledge you learn in this chapter.
You have been warned.</p>
</div>
<p>When talking about software development, itâ€™s easy to forget about cyber security.
Itâ€™s easy to assume that a security breach will never happen to you, especially if the code youâ€™re
writing is relatively simple or seemingly inconsequential.
Itâ€™s assumptions like these which cause <strong>catastrophic data breaches</strong> every single day.</p>
<p>In this chapter, we aim to demonstrate the importance of security-minded development,
using as simple an example of a vulnerable application as we could cook up.</p>
<div class="section" id="a-desceptively-terrifying-example">
<h2>A Desceptively Terrifying Example<a class="headerlink" href="#a-desceptively-terrifying-example" title="Permalink to this headline">Â¶</a></h2>
<p>Letâ€™s have a look at an example of a simple HTTP API server, written in Node.JS:</p>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>The following code is strictly intended as an example of how <strong>NOT</strong> to write code.</p>
<p>Itâ€™s buggy, chalk-full of security vulnerabilities, and it should <strong>NOT UNDER ANY CIRCUMSTANCES</strong>
be referred to as a reference application.</p>
</div>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">exec</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;child_process&#39;</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">Client</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;pg&#39;</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">cookieParser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;cookie-parser&#39;</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">cookieParser</span><span class="p">());</span>
<span class="kd">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="ow">new</span> <span class="nx">Client</span><span class="p">();</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">connect</span><span class="p">();</span>

<span class="c1">// Use a Map to associate users with login tokens:</span>
<span class="kd">let</span> <span class="nx">tokens</span> <span class="o">=</span> <span class="ow">new</span> <span class="nb">Map</span><span class="p">();</span>

<span class="c1">// Define a login route:</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/login/:user/:password&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Username: &#39;</span><span class="si">${</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">user</span><span class="si">}</span><span class="sb">&#39;, Password: &#39;</span><span class="si">${</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">password</span><span class="si">}</span><span class="sb">&#39;`</span><span class="p">);</span>
	<span class="c1">// Compute the password hash:</span>
	<span class="nx">exec</span><span class="p">(</span><span class="s1">&#39;echo -n &quot;&#39;</span> <span class="o">+</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">password</span> <span class="o">+</span> <span class="s1">&#39;&quot; | md5sum&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">hash</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
		<span class="nx">hash</span> <span class="o">=</span> <span class="nx">hash</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mf">0</span><span class="p">];</span>
		<span class="c1">// Check the database for a user with the same username and password hash:</span>
		<span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM users WHERE username=&#39;&quot;</span> <span class="o">+</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">user</span> <span class="o">+</span> <span class="s2">&quot;&#39; AND pwdhash=&#39;&quot;</span> <span class="o">+</span> <span class="nx">hash</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">users</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
			<span class="c1">// If the user wasn&#39;t found, don&#39;t let them sign in:</span>
			<span class="k">if</span><span class="p">(</span><span class="nx">users</span> <span class="o">&amp;&amp;</span> <span class="nx">users</span><span class="p">.</span><span class="nx">rowCount</span> <span class="o">===</span> <span class="mf">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">401</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;Authentication Failed&#39;</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="c1">// Generate a random auth token for the user:</span>
				<span class="kd">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mf">100</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
				<span class="nx">tokens</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">user</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

				<span class="c1">// Send the token back as a cookie:</span>
				<span class="nx">res</span><span class="p">.</span><span class="nx">cookie</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">user</span><span class="p">);</span>
				<span class="nx">res</span><span class="p">.</span><span class="nx">cookie</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>
				<span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">200</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;Authentication succeeded!&#39;</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">});</span>
	<span class="p">});</span>
<span class="p">});</span>

<span class="c1">// Define a password-protected route:</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/secret&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Getting Secret&#39;</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">req</span><span class="p">.</span><span class="nx">cookies</span><span class="p">.</span><span class="nx">token</span> <span class="o">||</span> <span class="nx">req</span><span class="p">.</span><span class="nx">cookies</span><span class="p">.</span><span class="nx">token</span> <span class="o">!==</span> <span class="nx">tokens</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">cookies</span><span class="p">.</span><span class="nx">user</span><span class="p">))</span> <span class="p">{</span>
		<span class="c1">// Unauthorized users get rejected:</span>
		<span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">401</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;Unauthorized request&#39;</span><span class="p">);</span>
		<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Secret Not Sent!&#39;</span><span class="p">)</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="c1">// Only authorized users can know the secret word:</span>
		<span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">200</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;The secret word is &quot;xylophone&quot;&#39;</span><span class="p">);</span>
		<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Secret Sent!&#39;</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mf">8081</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;App is listening on port 8081&#39;</span><span class="p">));</span>
</pre></div>
</div>
<p>Despite being only 52 lines long, this simple application with only 2 API routes (one for authenticating users,
and one for accessing some secret information) is still teeming with security holes.
That said, it is still a completely functional application.</p>
<p>As a demonstration, letâ€™s consider a python application which first authenticates as a valid user (username:
<em>me</em>, password: <em>password123</em>), and then proceeds to access the applicationâ€™s secrets:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import dependencies:</span>
<span class="kn">from</span> <span class="nn">aiohttp</span> <span class="kn">import</span> <span class="n">ClientSession</span>
<span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">parse</span>

<span class="c1"># Establish some basic info on the target:</span>
<span class="n">host</span> <span class="o">=</span> <span class="s1">&#39;localhost:8081&#39;</span>
<span class="n">username</span> <span class="o">=</span> <span class="s1">&#39;me&#39;</span>
<span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;password123&#39;</span>


<span class="k">async</span> <span class="k">with</span> <span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
	<span class="c1"># Send a login request to obtain an authorization token:</span>
	<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://</span><span class="si">{host}</span><span class="s1">/login/</span><span class="si">{username}</span><span class="s1">/</span><span class="si">{password}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
	<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Login URL: </span><span class="si">{url}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">))</span>
	<span class="n">res</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
	<span class="nb">print</span><span class="p">(</span><span class="k">await</span> <span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

	<span class="c1"># Print out the session&#39;s cookie details:</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">cookie_jar</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
		<span class="k">for</span> <span class="n">cookie</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">cookie_jar</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cookie &#39;</span><span class="si">{key}</span><span class="s2">&#39; has value </span><span class="se">\&quot;</span><span class="si">{value}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">cookie</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">cookie</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR: Failed to extract cookies from response&#39;</span><span class="p">)</span>

	<span class="c1"># Request the secret data from the server:</span>
	<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://</span><span class="si">{host}</span><span class="s1">/secret&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">)</span>
	<span class="n">res</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
	<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Secret: &#39;</span> <span class="o">+</span> <span class="k">await</span> <span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Login URL: http://localhost:8081/login/me/password123
Authentication succeeded!

Cookie &#39;user&#39; has value &quot;me&quot;
Cookie &#39;token&#39; has value &quot;80&quot;

Secret: The secret word is &quot;xylophone&quot;
</pre></div>
</div>
</div>
</div>
<p>As can be seen above, when presented with a valid username/password pair, the application functions
as expected, and spills itâ€™s secrets to a valid user.
Similarly, when provided with incorrect credentials, the application <em>should</em> reject that userâ€™s access.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Establish some basic info on the target:</span>
<span class="n">host</span> <span class="o">=</span> <span class="s1">&#39;localhost:8081&#39;</span>
<span class="n">username</span> <span class="o">=</span> <span class="s1">&#39;me&#39;</span>
<span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;wrongPassword&#39;</span>


<span class="k">async</span> <span class="k">with</span> <span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
	<span class="c1"># Send a login request to obtain an authorization token:</span>
	<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://</span><span class="si">{host}</span><span class="s1">/login/</span><span class="si">{username}</span><span class="s1">/</span><span class="si">{password}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
	<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Login URL: </span><span class="si">{url}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">))</span>
	<span class="n">res</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
	<span class="nb">print</span><span class="p">(</span><span class="k">await</span> <span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

	<span class="c1"># Print out the session&#39;s cookie details:</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">cookie_jar</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
		<span class="k">for</span> <span class="n">cookie</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">cookie_jar</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cookie &#39;</span><span class="si">{key}</span><span class="s2">&#39; has value </span><span class="se">\&quot;</span><span class="si">{value}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">cookie</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">cookie</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR: Failed to extract cookies from response&#39;</span><span class="p">)</span>

	<span class="c1"># Request the secret data from the server:</span>
	<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://</span><span class="si">{host}</span><span class="s1">/secret&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">)</span>
	<span class="n">res</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
	<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Secret: &#39;</span> <span class="o">+</span> <span class="k">await</span> <span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Login URL: http://localhost:8081/login/me/wrongPassword
Authentication Failed

ERROR: Failed to extract cookies from response

Secret: Unauthorized request
</pre></div>
</div>
</div>
</div>
<p>However, while this might seem like the application is behaving completely as intended, it is important
to realize that it this isnâ€™t sufficient to determine that the application is secure or safe to use.</p>
</div>
<div class="section" id="let-the-cyber-attacks-begin">
<h2>Let the Cyber Attacks Begin!<a class="headerlink" href="#let-the-cyber-attacks-begin" title="Permalink to this headline">Â¶</a></h2>
<p>In this chapter, we will use the above server code to explore itâ€™s various issues, and learn how those issues can be explioted
by attackers to achieve some seriously devistating results.</p>
<div class="attention admonition">
<p class="admonition-title">Challenge Activity</p>
<p>Before you read on, read through the above server code and try to come up with a list of all of the different
security problems you are able to find in the code.
Write that list down somewhere, so you can reflect on it once youâ€™ve completed this chapter.</p>
<div class="dropdown admonition hint">
<p class="admonition-title">Hint</p>
<p>For reference, our initial list consisted of 22 distinct security holes, but weâ€™re sure there are more
to be found!</p>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./appendix/cyber-security"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Buckley Ross<br/>
        
            &copy; Copyright 2021.<br/>
          <div class="extra_footer">
            <center>
Permission is granted to copy, distribute and/or modify this<br/>
document under the terms of the GNU Free Documentation License,<br/>
Version 1.3 or any later version published by the Free Software<br/>
Foundation; with no Invariant Sections, no Front-Cover Texts, and<br/>
no Back-Cover Texts.  A copy of the license is included in the<br/>
section entitled "GNU Free Documentation License".
</center>

          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>